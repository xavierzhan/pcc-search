<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ç£æ”¿åºœæ¨™æ¡ˆæŸ¥è©¢ (g0v API)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .tender-card {
            transition: transform 0.2s;
        }
        .tender-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .badge-price {
            background-color: #28a745;
        }
    </style>
</head>
<body class="bg-light">

<div class="container py-5">
    <h1 class="text-center mb-4">ğŸ›ï¸ æ”¿åºœæ¨™æ¡ˆç°¡æ˜“æŸ¥è©¢</h1>
    
    <div class="row justify-content-center mb-5">
        <div class="col-md-8">
            <div class="input-group">
                <input type="text" id="searchInput" class="form-control" placeholder="è¼¸å…¥é—œéµå­— (ä¾‹å¦‚ï¼šé›»è…¦ã€å·¥ç¨‹)..." value="å·¥ç¨‹">
                <button class="btn btn-primary" type="button" onclick="fetchTenders()">æœå°‹æ¨™æ¡ˆ</button>
            </div>
            <div class="form-text text-muted">è³‡æ–™ä¾†æºï¼špcc.g0v.ronny.tw (g0v é–‹æ”¾æ¨™æ¡ˆ)</div>
        </div>
    </div>

    <div id="loading" class="text-center d-none">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">è³‡æ–™è®€å–ä¸­...</p>
    </div>

    <div id="resultList" class="row g-4">
        </div>
</div>

<script>
    async function fetchTenders() {
        const keyword = document.getElementById('searchInput').value;
        const resultList = document.getElementById('resultList');
        const loading = document.getElementById('loading');

        // æ¸…ç©ºèˆŠè³‡æ–™ä¸¦é¡¯ç¤º Loading
        resultList.innerHTML = '';
        loading.classList.remove('d-none');

        try {
            // æ§‹å»º API URL
            // ä½¿ç”¨ Elasticsearch èªæ³•æŸ¥è©¢ title æ¬„ä½
            let apiUrl = `https://pcc.g0v.ronny.tw/api/list`;
            if(keyword) {
                apiUrl += `?q=title:${encodeURIComponent(keyword)}`;
            }

            const response = await fetch(apiUrl);
            const data = await response.json();

            // éš±è— Loading
            loading.classList.add('d-none');

            // æª¢æŸ¥æ˜¯å¦æœ‰è³‡æ–™
            if (!data.records || data.records.length === 0) {
                resultList.innerHTML = '<div class="col-12 text-center text-muted">æ‰¾ä¸åˆ°ç›¸é—œæ¨™æ¡ˆï¼Œè«‹å˜—è©¦å…¶ä»–é—œéµå­—ã€‚</div>';
                return;
            }

            // æ¸²æŸ“è³‡æ–™
            data.records.forEach(record => {
                // è™•ç†å¯èƒ½ç¼ºå¤±çš„æ¬„ä½
                const title = record.brief ? record.brief.title : record.title || 'ç„¡æ¨™é¡Œ';
                const unitName = record.unit_name || 'æœªçŸ¥å–®ä½';
                const date = record.date || 'æœªçŸ¥æ—¥æœŸ';
                // é ç®—é‡‘é¡é€šå¸¸åœ¨ detail è£¡ï¼Œé€™é‚Šå…ˆé¡¯ç¤ºé¡å‹
                const type = record.brief ? record.brief.type : 'æ¨™æ¡ˆ'; 
                // ç”¢ç”Ÿé€£çµåˆ°åŸå§‹æ”¿åºœæ¡è³¼ç¶²é é¢ (é€é Ronny çš„ä»‹é¢è½‰å°æˆ–ç›´æ¥çµ„ç¶²å€)
                // é€™è£¡æˆ‘å€‘é€£çµåˆ° Ronny çš„æª¢è¦–å™¨é é¢
                const link = `https://pcc.g0v.ronny.tw/tender/${record.unit_id}/${record.job_number}/${record.date}/${record.filename}`;

                const cardHTML = `
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 tender-card border-0 shadow-sm">
                            <div class="card-body">
                                <span class="badge bg-secondary mb-2">${date}</span>
                                <h5 class="card-title text-primary">${title}</h5>
                                <p class="card-text text-muted">
                                    <small>ğŸ¢ ${unitName}</small><br>
                                    <small>ğŸ“„ é¡å‹ï¼š${type}</small>
                                </p>
                                <a href="${link}" target="_blank" class="btn btn-outline-primary btn-sm stretched-link">æŸ¥çœ‹è©³æƒ…</a>
                            </div>
                        </div>
                    </div>
                `;
                resultList.innerHTML += cardHTML;
            });

        } catch (error) {
            console.error('Error:', error);
            loading.classList.add('d-none');
            resultList.innerHTML = `<div class="col-12 text-center text-danger">ç™¼ç”ŸéŒ¯èª¤ï¼š${error.message}</div>`;
        }
    }

    // é é¢è¼‰å…¥æ™‚å…ˆåŸ·è¡Œä¸€æ¬¡æœå°‹
    window.onload = fetchTenders;
</script>

</body>
</html>
